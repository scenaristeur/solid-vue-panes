(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c317c11c"],{"47c5":function(e,t,n){},"85fc":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"inbox container"},[null!=e.webId?n("div",[n("div",[n("b-button-toolbar",{attrs:{"aria-label":"Toolbar with button groups and dropdown menu"}},[n("b-button-group",{staticClass:"mx-1"},[n("b-button",{staticClass:"new",attrs:{title:"new",size:"sm",variant:"success"},on:{click:function(t){return t.stopPropagation(),e.init_new()}}},[n("b-icon-pencil-square",{attrs:{variant:"outline-success"},on:{click:function(t){return t.stopPropagation(),e.init_new()}}})],1)],1)],1)],1),n("b-list-group",e._l(e.inbox.files.slice().reverse(),(function(e){return n("b-list-group-item",{key:e.name},[n("MessageLine",{attrs:{message:e}})],1)})),1),n("b-modal",{attrs:{id:"confirm-trash",title:"Are you sure you want to delete"},on:{ok:e.trash}},[e._v(" "+e._s(e.toTrash)+" ")]),n("b-modal",{attrs:{id:"send-modal",title:e.title},on:{ok:e.send,cancel:function(t){e.selected=[]}}},[n("div",{staticClass:"container flush"},[1==e.showFriends?n("FriendsSelection",{on:{selected:e.onSelected}}):e._e(),n("b-form-group",[n("label",{attrs:{for:"destinataire"}},[e._v("WebId :")]),n("b-form-input",{attrs:{id:"destinataire",placeholder:"ex: https://spoggy-test.solid.community/profile/card#me"},model:{value:e.recipient,callback:function(t){e.recipient=t},expression:"recipient"}})],1)],1),n("b-list-group",[n("b-input-group",{attrs:{prepend:"Label"}},[n("b-form-input",{model:{value:e.label,callback:function(t){e.label=t},expression:"label"}})],1),n("b-form-textarea",{attrs:{id:"textarea-rows",placeholder:"",rows:"8"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)],1),n("p",[e._v("To test the inbox, you can add me to your friends :"),n("br"),n("b-button",{attrs:{to:e.link,variant:"outline-info"}},[e._v("Add Popock dev to your friends")])],1)],1):n("div",[n("SolidLoginButton")],1)])},r=[],s=(n("99af"),n("4160"),n("fb6a"),n("d3b7"),n("ac1f"),n("1276"),n("159b"),n("96cf"),n("1da1")),i=n("cb85"),a=n("4380"),c=n("eb27"),l=n("00e8"),u=n.n(l),d=n("4d8d"),b=n("6dc1"),h=window.SolidFileClient;console.log("SFC",h);var f=new h(u.a),p={name:"Inbox",mixins:[i["a"],a["a"],c["a"]],components:{MessageLine:function(){return n.e("chunk-2c876163").then(n.bind(null,"5d33"))},FriendsSelection:function(){return n.e("chunk-2d0b219b").then(n.bind(null,"2359"))},SolidLoginButton:function(){return n.e("chunk-457eee6c").then(n.bind(null,"e9a1"))}},props:["value"],data:function(){return{inbox_urls:[],inbox:{files:[]},selected:[],title:"",content:"",label:"",recipient:null,showFriends:!0}},created:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.webId=e.$store.state.solid.webId,console.log("################# created inbox webid",e.webId),null==e.webId){t.next=16;break}return t.next=5,e.getInboxUrls(e.webId);case 5:return e.inbox_urls=t.sent,e.storage=e.$store.state.solid.storage,t.next=9,e.inbox_init("created webId non null");case 9:return t.next=11,e.configureInbox(e.inbox_urls[0],e.webId,e.storage);case 11:e.inbox_log_file=e.storage+"popock/inbox_log.ttl",console.log("created inbox_log_file",e.inbox_log_file),e.subscribe(),t.next=19;break;case 16:return t.next=18,e.inbox_init("created webId null");case 18:e.popupLogin();case 19:case"end":return t.stop()}}),t)})))()},watch:{webId:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.inbox_init("webid watch");case 2:if(console.log("############# WEBID changed",e),null==e){n.next=7;break}return n.next=6,t.getInboxUrls(e);case 6:t.inbox_urls=n.sent;case 7:case"end":return n.stop()}}),n)})))()},inbox_urls:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.current_inbox_url=e[0],null!=t.current_inbox_url&&(console.log(t.current_inbox_url),t.getMessages());case 2:case"end":return n.stop()}}),n)})))()},reply:function(e){console.log("reply",e),this.showFriends=!1,this.$bvModal.show("send-modal"),this.selected=[],this.recipient=e.sender,this.label="ref: "+e.label},storage:function(e){null!=e&&(this.inbox_log_file=e+"popock/inbox_log.ttl",console.log("STORAGE WATCH inbox_log_file",this.inbox_log_file),this.subscribe())}},methods:{inbox_init:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log("###################################### INBOX INIT from ",e),console.log("INIT WITH",t.webId,t.inbox_urls[0],t.storage);case 2:case"end":return n.stop()}}),n)})))()},notify:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"This is an example!";this.$notification.show("Hello World",{body:e},{})},send:function(){if(console.log(this.title,this.content,this.selected,this.label,this.recipient),null!=this.recipient&&this.selected.push(this.recipient),console.log("selected",this.selected),this.content.length>0){var e={},t=new Date;e.date=t.toISOString(),e.id=t.getTime(),e.sender=this.webId,e.content=this.content,e.label=this.label;var n='\n        @prefix : <#>.\n        @prefix schem: <http://schema.org/>.\n        @prefix sch: <https://schema.org/>.\n        @prefix rd: <http://www.w3.org/2000/01/rdf-schema#>.\n\n        <>\n        a sch:Message;\n        schem:dateSent "'.concat(e.date,'";\n        schem:sender <').concat(e.sender,'>;\n        schem:text "').concat(e.content,'";\n        rd:label "').concat(e.label,'";\n        schem:abstract "this message can be opened with inbox of Popock https://scenaristeur.github.io/solid-vue-panes/".\n        ');console.log(n);var o=this.getInboxUrls;console.log(this.selected),this.selected.forEach(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var s,i,a,c,l,u,h;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o(r);case 2:if(s=t.sent,!(void 0!=s&&s.length>0)){t.next=38;break}return console.log("INBOX",s),e.url=s[0]+e.id+".ttl",console.log(e.url),t.next=9,f.postFile(e.url,n,"text/turtle");case 9:return console.log("find storage of ",r),t.next=12,Object(d["b"])(r);case 12:return i=t.sent,t.next=15,i.getSubject(r);case 15:return a=t.sent,t.next=18,a.getNodeRef(b["h"].storage);case 18:return c=t.sent,console.log("".concat(c)),l="".concat(c)+"popock/inbox_log.ttl",console.log(l),u={},t.prev=23,t.next=26,Object(d["b"])(l);case 26:u=t.sent,t.next=34;break;case 29:return t.prev=29,t.t0=t["catch"](23),t.next=33,Object(d["a"])(l);case 33:u=t.sent;case 34:return h=u.addSubject(),h.addNodeRef(b["f"].about,e.url),t.next=38,u.save();case 38:case"end":return t.stop()}}),t,null,[[23,29]])})));return function(e){return t.apply(this,arguments)}}())}else alert("content must not be empty")},onSelected:function(e){this.selected=e,console.log(this.selected)},init_new:function(){console.log("new"),this.showFriends=!0,this.$bvModal.show("send-modal"),this.selected=[],this.recipient=null,this.label="",this.content=""},subscribe:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,o,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n="wss://"+e.inbox_log_file.split("/")[2],o=new WebSocket(n,["solid.0.1.0"]),r=e.inbox_log_file,o.onopen=function(){this.send("sub "+r),console.log("subscribe to INBOX",n,r)},s=e.getMessages,o.onmessage=function(e){console.log(e),e.data&&"pub"===e.data.slice(0,3)&&(console.log(e.data),s())};case 6:case"end":return t.stop()}}),t)})))()},getMessages:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,f.readFolder(e.current_inbox_url);case 2:e.inbox=t.sent,e.notify(e.inbox.files.length+" messages !!!"),e.$store.commit("inbox/setInbox",e.inbox);case 5:case"end":return t.stop()}}),t)})))()},trash:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e.toTrash),t.next=3,f.deleteFile(e.toTrash);case 3:return console.log("File deleted !"),t.next=6,Object(d["b"])(e.inbox_log_file);case 6:return n=t.sent,o=n.findSubject(b["f"].about,e.toTrash),n.removeSubject(o),t.next=11,n.save();case 11:case"end":return t.stop()}}),t)})))()}},computed:{webId:{get:function(){return this.$store.state.solid.webId},set:function(){}},toTrash:function(){return this.$store.state.inbox.toTrash},reply:function(){return this.$store.state.inbox.reply},storage:{get:function(){return this.$store.state.solid.storage},set:function(){}},link:function(){console.log("route",this.$route,location.href,location.host);var e="/friends?add=https://spoggy.solid.community/profile/card#me";return e}}},g=p,x=(n("90a3"),n("2877")),m=Object(x["a"])(g,o,r,!1,null,null,null);t["default"]=m.exports},"90a3":function(e,t,n){"use strict";var o=n("47c5"),r=n.n(o);r.a},"99af":function(e,t,n){"use strict";var o=n("23e7"),r=n("d039"),s=n("e8b5"),i=n("861d"),a=n("7b0b"),c=n("50c4"),l=n("8418"),u=n("65f0"),d=n("1dde"),b=n("b622"),h=n("2d00"),f=b("isConcatSpreadable"),p=9007199254740991,g="Maximum allowed index exceeded",x=h>=51||!r((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),m=d("concat"),w=function(e){if(!i(e))return!1;var t=e[f];return void 0!==t?!!t:s(e)},v=!x||!m;o({target:"Array",proto:!0,forced:v},{concat:function(e){var t,n,o,r,s,i=a(this),d=u(i,0),b=0;for(t=-1,o=arguments.length;t<o;t++)if(s=-1===t?i:arguments[t],w(s)){if(r=c(s.length),b+r>p)throw TypeError(g);for(n=0;n<r;n++,b++)n in s&&l(d,b,s[n])}else{if(b>=p)throw TypeError(g);l(d,b++,s)}return d.length=b,d}})},cb85:function(e,t,n){"use strict";n("96cf");var o=n("1da1"),r=n("00e8"),s=n.n(r);t["a"]={methods:{popupLogin:function(){return Object(o["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s.a.currentSession();case 2:if(t=e.sent,n="./dist-popup/popup.html",t){e.next=8;break}return e.next=7,s.a.popupLogin({popupUri:n});case 7:t=e.sent;case 8:case"end":return e.stop()}}),e)})))()},makeToast:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$bvToast.toast(t,{title:e,variant:n,solid:!0})}}}}}]);
//# sourceMappingURL=chunk-c317c11c.60741ac9.js.map